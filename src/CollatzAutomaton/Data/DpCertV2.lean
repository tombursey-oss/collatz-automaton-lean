-- Auto-generated DP certificate checker for v2 (length 16, reachable graph).
-- Source: dp_cert_v2.json (see accompanying sha256).

import Mathlib.Data.Nat.Basic
import Mathlib.Data.List.Basic
import Mathlib.Tactic

namespace CollatzV2

def N : Nat := 42
def L : Nat := 16
def INF : Nat := 1000000000

structure Edge where
  u : Nat
  v : Nat
  r : Nat
deriving DecidableEq, Repr

def edges : List Edge :=
  [
    { u := 0, v := 0, r := 2 },
    { u := 4, v := 0, r := 4 },
    { u := 15, v := 0, r := 6 },
    { u := 29, v := 1, r := 1 },
    { u := 18, v := 3, r := 2 },
    { u := 2, v := 4, r := 1 },
    { u := 9, v := 4, r := 3 },
    { u := 35, v := 4, r := 5 },
    { u := 7, v := 5, r := 2 },
    { u := 25, v := 5, r := 4 },
    { u := 32, v := 6, r := 1 },
    { u := 5, v := 8, r := 1 },
    { u := 20, v := 8, r := 3 },
    { u := 12, v := 9, r := 2 },
    { u := 34, v := 10, r := 1 },
    { u := 22, v := 11, r := 1 },
    { u := 8, v := 12, r := 1 },
    { u := 31, v := 12, r := 3 },
    { u := 17, v := 13, r := 2 },
    { u := 26, v := 13, r := 4 },
    { u := 36, v := 14, r := 1 },
    { u := 11, v := 16, r := 1 },
    { u := 39, v := 16, r := 3 },
    { u := 23, v := 17, r := 2 },
    { u := 38, v := 18, r := 1 },
    { u := 10, v := 20, r := 3 },
    { u := 13, v := 20, r := 1 },
    { u := 28, v := 21, r := 2 },
    { u := 41, v := 22, r := 1 },
    { u := 30, v := 23, r := 1 },
    { u := 16, v := 24, r := 1 },
    { u := 33, v := 25, r := 2 },
    { u := 3, v := 26, r := 1 },
    { u := 19, v := 28, r := 1 },
    { u := 37, v := 29, r := 2 },
    { u := 6, v := 30, r := 1 },
    { u := 21, v := 32, r := 1 },
    { u := 40, v := 32, r := 3 },
    { u := 1, v := 33, r := 2 },
    { u := 24, v := 35, r := 1 },
    { u := 27, v := 38, r := 1 },
    { u := 14, v := 40, r := 1 }
  ]

def B0 : List Nat :=
  [0, 2, 4, 5, 7, 8, 9, 11, 12, 13, 15, 16, 17, 19, 20, 21, 23, 24, 25, 27, 28, 29, 31, 32, 33, 34, 35, 36, 37, 38, 39, 41]

def dp : List (List Nat) :=
  [
    [0, 1000000000, 0, 1000000000, 0, 0, 1000000000, 0, 0, 0, 1000000000, 0, 0, 0, 1000000000, 0, 0, 0, 1000000000, 0, 0, 0, 1000000000, 0, 0, 0, 1000000000, 0, 0, 0, 1000000000, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1000000000, 0],
    [2, 1, 1000000000, 1000000000, 1, 2, 1, 1000000000, 1, 2, 1, 1000000000, 1, 2, 1, 1000000000, 1, 2, 1, 1000000000, 1, 2, 1, 1000000000, 1, 2, 1000000000, 1000000000, 1, 2, 1000000000, 1000000000, 1, 1000000000, 1000000000, 1, 1000000000, 1000000000, 1, 1000000000, 1000000000, 1000000000],
    [4, 3, 1000000000, 3, 5, 6, 2, 1000000000, 3, 3, 1000000000, 2, 2, 4, 1000000000, 1000000000, 1000000000, 1000000000, 2, 1000000000, 3, 3, 1000000000, 1000000000, 2, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 2, 1000000000, 3, 3, 1000000000, 2, 1000000000, 1000000000, 1000000000, 1000000000, 2, 1000000000],
    [6, 1000000000, 1000000000, 4, 6, 1000000000, 4, 1000000000, 6, 4, 1000000000, 1000000000, 4, 1000000000, 1000000000, 1000000000, 3, 1000000000, 1000000000, 1000000000, 5, 1000000000, 1000000000, 3, 1000000000, 5, 4, 1000000000, 1000000000, 1000000000, 3, 1000000000, 4, 5, 1000000000, 3, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000],
    [8, 1000000000, 1000000000, 1000000000, 7, 9, 5, 1000000000, 8, 6, 1000000000, 1000000000, 7, 8, 1000000000, 1000000000, 1000000000, 5, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 4, 4, 7, 5, 1000000000, 1000000000, 1000000000, 5, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000],
    [10, 1000000000, 1000000000, 1000000000, 9, 11, 1000000000, 1000000000, 10, 9, 1000000000, 1000000000, 9, 7, 1000000000, 1000000000, 1000000000, 6, 1000000000, 1000000000, 9, 1000000000, 1000000000, 6, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 6, 1000000000, 1000000000, 1000000000, 1000000000, 5, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000],
    [12, 1000000000, 1000000000, 1000000000, 10, 1000000000, 1000000000, 1000000000, 12, 11, 1000000000, 1000000000, 11, 8, 1000000000, 1000000000, 1000000000, 8, 1000000000, 1000000000, 8, 1000000000, 1000000000, 7, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000],
    [14, 1000000000, 1000000000, 1000000000, 14, 1000000000, 1000000000, 1000000000, 11, 13, 1000000000, 1000000000, 13, 10, 1000000000, 1000000000, 1000000000, 9, 1000000000, 1000000000, 9, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000],
    [16, 1000000000, 1000000000, 1000000000, 16, 1000000000, 1000000000, 1000000000, 12, 15, 1000000000, 1000000000, 12, 11, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 11, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000],
    [18, 1000000000, 1000000000, 1000000000, 18, 1000000000, 1000000000, 1000000000, 14, 14, 1000000000, 1000000000, 13, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 12, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000],
    [20, 1000000000, 1000000000, 1000000000, 17, 1000000000, 1000000000, 1000000000, 15, 15, 1000000000, 1000000000, 15, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000],
    [21, 1000000000, 1000000000, 1000000000, 18, 1000000000, 1000000000, 1000000000, 1000000000, 17, 1000000000, 1000000000, 16, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000],
    [22, 1000000000, 1000000000, 1000000000, 20, 1000000000, 1000000000, 1000000000, 1000000000, 18, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000],
    [24, 1000000000, 1000000000, 1000000000, 21, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000],
    [25, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000],
    [27, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000],
    [29, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000, 1000000000]
  ]

def getRow (t : Nat) : List Nat := (dp.getD t [])
def getVal (t v : Nat) : Nat := ((getRow t).getD v INF)

def incoming (v : Nat) : List Edge := edges.filter (fun e => e.v = v)

def stepMin (t v : Nat) : Nat :=
  (incoming v).foldl (fun best e => Nat.min best (getVal t e.u + e.r)) INF

def dpStepOK (t v : Nat) : Bool :=
  decide (getVal (t+1) v = stepMin t v)

def dpBaseOK (v : Nat) : Bool :=
  if v ∈ B0 then decide (getVal 0 v = 0) else decide (getVal 0 v = INF)

def allNodes : List Nat := List.range N
def allTimes : List Nat := List.range L  -- checks t=0..L-1

def dpOKb : Bool :=
  (allNodes.all dpBaseOK) && (allTimes.all (fun t => allNodes.all (fun v => dpStepOK t v)))

def minRow (xs : List Nat) : Nat := xs.foldl Nat.min INF
def minDpL : Nat := minRow (getRow L)

theorem dp_rec_valid : dpOKb = true := by
  native_decide

theorem minDpL_eq : minDpL = 29 := by
  native_decide

-- This is the Lemma 8-style bound: every reachable length-16 window has sum r ≥ 29.
theorem minDpL_ge_29 : minDpL ≥ 29 := by
  native_decide

end CollatzV2
